<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cardGGaduekMainService.product.categoryPageContent.mapper.CategoryPageContentMapper">

    <select id="findBenefitContentForMember" resultType="org.cardGGaduekMainService.product.categoryPageContent.dto.CategoryPageContentDTO">
        SELECT
        cpc.id,
        cpc.category_name AS categoryName,
        cpc.title,
        cpc.description,
        cpc.image_url AS imageUrl,
        cpc.link_url AS linkUrl
        FROM
        category_page_content cpc
        WHERE
        cpc.category_name = #{categoryName}
        AND EXISTS (
        -- ì‚¬ìš©ìê°€ ê°€ì§„ ì¹´ë“œ ì¤‘, ì´ ì¹´í…Œê³ ë¦¬ í˜œíƒì´ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€ í™•ì¸
        SELECT *
        FROM store_benefit cb
        WHERE
        cb.store_category = #{categoryName} -- ğŸ’¡ ì¹´í…Œê³ ë¦¬ ì´ë¦„ìœ¼ë¡œ ì§ì ‘ ë¹„êµ
        AND cb.card_product_id IN
        <foreach item="cardId" collection="userCardProductIds" open="(" separator="," close=")">
            #{cardId}
        </foreach>
        )
    </select>

    <select id="findByCategoryName" parameterType="string" resultType="org.cardGGaduekMainService.product.categoryPageContent.dto.CategoryPageContentDTO">
        SELECT
            id,
            category_name AS categoryName,
            title,
            description,
            image_url AS imageUrl,
            link_url AS linkUrl,
            price
        FROM
            category_page_content
        WHERE
            category_name = #{categoryName}
    </select>
</mapper>